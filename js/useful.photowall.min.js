/*
	Source:
	van Creij, Maurice (2012). "useful.photowall.js: Simple photo wall", version 20120606, http://www.woollymittens.nl/.

	License:
	This work is licensed under a Creative Commons Attribution 3.0 Unported License.

	Prerequisites:
	<script src="./js/useful.js"></script>
*/(function(e){"use strict";var t={};t={start:function(n,r){r.parent=n;r.parent.className+=" photowall-passive";r.images={};r.images.links=n.getElementsByTagName("a");r.images.objects=n.getElementsByTagName("img");t.prepare(r);t.busy.build(r);if(document.readyState==="complete"){t.thumbnails.measure(r);t.thumbnails.redraw(r)}else e.events.add(window,"load",function(){t.thumbnails.measure(r);t.thumbnails.redraw(r)})},prepare:function(e){e.parent.innerHTML=e.parent.innerHTML.replace(/\t|\r|\n/g,"");e.col=e.parent.offsetWidth;e.aspect=e.height/e.col},busy:{build:function(e){e.spinner=document.createElement("div");e.spinner.className="photowall-busy photowall-busy-passive";e.parent.appendChild(e.spinner)},show:function(e){e.spinner.className=e.spinner.className.replace(/-passive/gi,"-active")},hide:function(e){e.spinner.className=e.spinner.className.replace(/-active/gi,"-passive")}},details:{show:function(e,n){if(!n.popup){t.busy.show(n);n.popup=document.createElement("div");n.popup.className="photowall-detail photowall-detail-passive";t.details.addCloser(n);n.parent.appendChild(n.popup);t.details.addImage(e,n)}},addImage:function(e,n){var r,i,s,o,u,a,f;r=n.parent.offsetWidth;i=n.parent.offsetHeight;s=i/r;if(n.images.aspects[e]>s){u=i/n.images.aspects[e];a=i}else{u=r;a=r*n.images.aspects[e]}f=n.images.links[e].getAttribute("title")||n.images.objects[e].getAttribute("alt");o=document.createElement("img");o.className="photowall-image";o.setAttribute("alt",f);o.onload=function(){t.details.open(n)};o.style.marginTop=Math.round((i-a)/2)+"px";n.popup.appendChild(o);o.src=n.slice?n.slice.replace("{src}",n.images.links[e].getAttribute("href")).replace("{width}",Math.round(u)).replace("{height}",Math.round(a)):n.images.links[e]},addCloser:function(e){var n;n=document.createElement("a");n.className="photowall-closer";n.innerHTML="x";n.href="#close";n.onclick=function(){t.details.close(e);return!1};e.popup.appendChild(n)},open:function(e){if(e.popup){t.busy.hide(e);e.popup.className=e.popup.className.replace(/-passive/gi,"-active")}},close:function(e){if(e.popup){e.closed!==null&&e.closed();e.popup.className=e.popup.className.replace(/-active/gi,"-passive");setTimeout(function(){e.parent.removeChild(e.popup);e.popup=null},500)}}},thumbnails:{measure:function(e){var t,n;e.images.widths=[];e.images.heights=[];e.images.aspects=[];for(t=0,n=e.images.objects.length;t<n;t+=1){e.images.widths[t]=e.images.objects[t].offsetWidth;e.images.heights[t]=e.images.objects[t].offsetHeight;e.images.aspects[t]=e.images.heights[t]/e.images.widths[t]}},redraw:function(e){var n,r,i,s,o,u,a=0,f=[];for(n=0,r=e.images.objects.length,i=r-1;n<r;n+=1){u=e.row/e.images.aspects[n];a+=u;f.push({link:e.images.links[n],object:e.images.objects[n],proportionalWidth:u});if(a>=e.col||n===i){n===i&&f.length<=e.orphans&&(a=e.col);for(s=0,o=f.length;s<o;s+=1){f[s].object.style.width=f[s].proportionalWidth/a*100+"%";f[s].object.style.height="auto"}f=[];a=0}t.thumbnails.clicked(n,e)}e.parent.className=e.parent.className.replace("-passive","-active")},clicked:function(e,n){n.images.objects[e].onclick=function(){n.opened!==null&&n.opened(n.images.objects[e],n.images.links[e]);t.details.show(e,n);return!1}}}};e.events=e.events||{};e.events.add=function(e,t,n){t=navigator.userAgent.match(/Firefox/i)&&t.match(/mousewheel/i)?"DOMMouseScroll":t;"addEventListener"in e?e.addEventListener(t,n,!1):"attachEvent"in e?e.attachEvent("on"+t,function(e){n(e)}):e["on"+t]=n};e.models=e.models||{};e.models.clone=function(e){var t,n;if(typeof Object.create!="undefined")t=Object.create(e);else{n=function(){};n.prototype=e;t=new n}return t};e.css=e.css||{};e.css.select=function(t,n){var r,i,s;n=n||document;t=typeof t=="string"?{rule:t,parent:n}:t;t.parent=t.parent||document;t.data=t.data||{};s=typeof document.querySelectorAll!="undefined"?t.parent.querySelectorAll(t.rule):typeof jQuery!="undefined"?jQuery(t.parent).find(t.rule).get():[];if(typeof t.handler=="undefined")return s;for(r=0,i=s.length;r<i;r+=1)t.handler(s[r],e.models.clone(t.data))};e.photowall={};e.photowall.start=t.start})(window.useful=window.useful||{});