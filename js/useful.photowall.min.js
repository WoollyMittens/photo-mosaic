/*
	Source:
	van Creij, Maurice (2012). "useful.photowall.js: Simple photo wall", version 20120606, http://www.woollymittens.nl/.

	License:
	This work is licensed under a Creative Commons Attribution 3.0 Unported License.

	Prerequisites:
	<script src="./js/useful.js"></script>
*/(function(e){"use strict";var t={};t={start:function(e,n){n.parent=e;n.parent.className+=" photowall-passive";n.images={};n.images.links=e.getElementsByTagName("a");n.images.objects=e.getElementsByTagName("img");t.prepare(n);t.busy.build(n);n.wait=setInterval(function(){if(t.thumbnails.complete(n)){clearTimeout(n.wait);t.thumbnails.measure(n);t.thumbnails.redraw(n)}},500)},prepare:function(e){e.parent.innerHTML=e.parent.innerHTML.replace(/\t|\r|\n/g,"");e.col=e.parent.offsetWidth;e.aspect=e.height/e.col},busy:{build:function(e){e.spinner=document.createElement("div");e.spinner.className="photowall-busy photowall-busy-passive";e.parent.appendChild(e.spinner)},show:function(e){e.spinner.className=e.spinner.className.replace(/-passive/gi,"-active")},hide:function(e){e.spinner.className=e.spinner.className.replace(/-active/gi,"-passive")}},details:{show:function(e,n){if(!n.popup){t.busy.show(n);n.popup=document.createElement("div");n.popup.className="photowall-detail photowall-detail-passive";n.popup.className+=n.maximise?" photowall-detail-maximise":"";t.details.addCloser(n);n.parent.appendChild(n.popup);t.details.addImage(e,n)}},addImage:function(e,n){var r,i,s,o,u,a,f,l,c;r=n.popup.offsetWidth;i=n.popup.offsetHeight;s=i/r;l=n.images.aspects[e]>s?"height="+i:"width="+r;f=n.images.links[e].getAttribute("href");c=n.images.links[e].getAttribute("title")||n.images.objects[e].getAttribute("alt");o=document.createElement("img");o.className="photowall-image";o.setAttribute("alt",c);o.onload=t.details.open(n);n.popup.appendChild(o);o.src=n.slice?n.slice.replace("{src}",f).replace("{size}",l):n.images.links[e]},addCloser:function(e){var n;n=document.createElement("a");n.className="photowall-closer";n.innerHTML="x";n.href="#close";n.onclick=t.details.close(e);e.popup.appendChild(n)},open:function(e){return function(){var n;if(e.popup){t.busy.hide(e);n=e.popup.getElementsByTagName("img")[0];n.style.marginTop=Math.round((e.popup.offsetHeight-n.offsetHeight)/2)+"px";e.popup.className=e.popup.className.replace(/-passive/gi,"-active")}}},close:function(e){return function(){if(e.popup){e.closed!==null&&e.closed();e.popup.className=e.popup.className.replace(/-active/gi,"-passive");setTimeout(function(){e.parent.removeChild(e.popup);e.popup=null},500)}return!1}}},thumbnails:{complete:function(e){var t,n,r=!0;for(t=0,n=e.images.objects.length;t<n;t+=1)r=r&&e.images.objects[t].offsetWidth>2;return r},measure:function(e){var t,n;e.images.widths=[];e.images.heights=[];e.images.aspects=[];for(t=0,n=e.images.objects.length;t<n;t+=1){e.images.widths[t]=e.images.objects[t].offsetWidth;e.images.heights[t]=e.images.objects[t].offsetHeight;e.images.aspects[t]=e.images.heights[t]/e.images.widths[t]}},redraw:function(e){var n,r,i,s,o,u,a,f=0,l=[];for(n=0,r=e.images.objects.length,i=r-1;n<r;n+=1){a=e.row/e.images.aspects[n];f+=a;l.push({link:e.images.links[n],object:e.images.objects[n],proportionalWidth:a});if(f>=e.col||n===i){n===i&&l.length<=e.orphans&&(f=e.col);for(s=0,o=l.length;s<o;s+=1){u=e.fallback?Math.round(l[s].proportionalWidth/f*(e.col-18))+"px":l[s].proportionalWidth/f*100+"%";l[s].object.style.width=u;l[s].object.style.height="auto"}l=[];f=0}e.images.objects[n].onclick=t.thumbnails.clicked(n,e)}e.parent.className=e.parent.className.replace("-passive","-active")},clicked:function(e,n){return function(){var r;n.opened!==null&&(r=n.opened(n.images.objects[e],n.images.links[e]));(typeof r=="undefined"||r===null||r)&&t.details.show(e,n);return!1}}}};e.events=e.events||{};e.events.add=function(e,t,n){t=navigator.userAgent.match(/Firefox/i)&&t.match(/mousewheel/i)?"DOMMouseScroll":t;"addEventListener"in e?e.addEventListener(t,n,!1):"attachEvent"in e?e.attachEvent("on"+t,function(e){n(e)}):e["on"+t]=n};e.models=e.models||{};e.models.clone=function(e){var t,n;if(typeof Object.create!="undefined")t=Object.create(e);else{n=function(){};n.prototype=e;t=new n}return t};e.css=e.css||{};e.css.select=function(t,n){var r,i,s;n=n||document;t=typeof t=="string"?{rule:t,parent:n}:t;t.parent=t.parent||document;t.data=t.data||{};s=typeof document.querySelectorAll!="undefined"?t.parent.querySelectorAll(t.rule):typeof jQuery!="undefined"?jQuery(t.parent).find(t.rule).get():[];if(typeof t.handler=="undefined")return s;for(r=0,i=s.length;r<i;r+=1)t.handler(s[r],e.models.clone(t.data))};e.photowall={};e.photowall.start=t.start})(window.useful=window.useful||{});